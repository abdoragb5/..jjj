<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zack's - تسجيل الدخول</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <style>
        body {
            font-family: 'IBM Plex Sans Arabic', sans-serif;
            background-color: #f3f4f6; 
            color: #374151; 
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh; 
        }
        /* Styles for Login Section */
        #login-section {
            background-color: white;
            padding: 2rem; 
            border-radius: 0.75rem; 
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            width: 100%;
            max-width: 28rem; 
        }
        .login-title {
            color: #F97316; 
        }
        .login-button {
            background-color: #F97316; 
            transition: background-color 0.3s ease;
        }
        .login-button:hover {
            background-color: #EA580C; 
        }
        .error-message {
            background-color: #fee2e2; 
            color: #b91c1c; 
            border: 1px solid #fecaca; 
        }

        /* Styles for Admin & Cashier Panels (when visible) */
        .app-shell-visible {
            display: flex; 
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        /* Styles from previous ZacksAdminPanel */
        .sidebar {
            background-color: #1f2937; 
            color: #d1d5db; 
            transition: width 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        .sidebar-link {
            transition: background-color 0.2s ease, color 0.2s ease, padding-right 0.2s ease;
            border-right: 4px solid transparent;
        }
        .sidebar-link:hover {
            background-color: #374151; 
            color: white;
            border-right-color: #F97316; 
        }
        .sidebar-link.active {
            background-color: #F97316; 
            color: white;
            font-weight: 500;
            border-right-color: #ffffff;
        }
        .sidebar-link i {
            transition: transform 0.2s ease;
        }
        .sidebar-link:hover i {
            transform: scale(1.1);
        }
        .content-area { /* This class might be from an older version, ensure mainContent is used for layout */
            transition: margin-right 0.3s ease-in-out;
        }
        .stat-card {
            background-color: white;
            border-left: 5px solid #F97316; 
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            padding: 1.5rem; 
            border-radius: 0.5rem; 
        }
         .stat-card-primary {
            background-color: #F97316; 
            color: white;
            border-left-color: #EA580C; 
        }
        .stat-card-primary p, .stat-card-primary i {
            color: white !important;
        }
        .stat-card-secondary {
             background-color: #fff7ed; 
             border-left-color: #FBBE24; 
             color: #92400E; 
        }
        .stat-card-secondary p, .stat-card-secondary i {
            color: #B45309; 
        }
        .stat-card-secondary .font-bold {
            color: #92400E; 
        }
        .modal-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        .modal-content {
            transition: transform 0.3s ease-in-out;
        }
        .main-content-scroll::-webkit-scrollbar { width: 8px; }
        .main-content-scroll::-webkit-scrollbar-track { background: #e5e7eb; border-radius: 10px;}
        .main-content-scroll::-webkit-scrollbar-thumb { background: #F97316; border-radius: 10px;}
        .main-content-scroll::-webkit-scrollbar-thumb:hover { background: #EA580C; }
        table thead th {
            background-color: #f3f4f6; 
            color: #374151; 
            font-weight: 600; 
        }
        table tbody tr:nth-child(even) {
            background-color: #f9fafb; 
        }
        table tbody tr:hover {
            background-color: #fefce8; 
        }
        .sidebar-collapsed .sidebar-text, .sidebar-collapsed #brandNameSidebar {
            display: none;
        }
        .sidebar-collapsed .sidebar-link i {
            margin-left: auto; 
            margin-right: auto;
        }
        .sidebar-collapsed #sidebarToggleDesktop i {
             transform: rotate(180deg);
        }
        .clickable-row:hover {
            background-color: #fffbeb; 
            cursor: pointer;
        }
        #itemForm::-webkit-scrollbar { width: 6px; }
        #itemForm::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px;}
        #itemForm::-webkit-scrollbar-thumb { background: #F97316; border-radius: 10px;}
        #itemForm::-webkit-scrollbar-thumb:hover { background: #EA580C; }
        .report-card {
            background-color: white;
            border-radius: 0.5rem; 
            padding: 1.5rem; 
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            text-align: center;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
        }
        .report-card i {
            font-size: 2.5rem; 
            margin-bottom: 0.75rem; 
            color: #F97316; 
        }
        .report-card h4 {
            font-size: 1.125rem; 
            font-weight: 600; 
            margin-bottom: 0.5rem; 
            color: #1f2937; 
        }
        .report-card p.coming-soon {
            font-size: 0.875rem; 
            color: #6b7280; 
            background-color: #fef3c7; 
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem; 
            display: inline-block;
        }
        /* Styles for Cashier Panel */
        #cashier-panel-section .cashier-header {
             background-color: #1f2937; 
             color: white;
        }
         #cashier-panel-section .cashier-content {
            padding: 2rem; 
            text-align: center;
         }
    </style>
</head>
<body>

    <section id="login-section" class="block">
        <div class="text-center mb-8">
            <img src="https://placehold.co/80x80/F97316/FFFFFF?text=Z" alt="Zack's Logo" class="h-20 w-20 rounded-full mx-auto mb-4">
            <h2 class="text-3xl font-bold login-title">أهلاً بك في Zack's</h2>
            <p class="text-gray-600">يرجى تسجيل الدخول للمتابعة</p>
        </div>
        <form id="loginForm">
            <div class="mb-4">
                <label for="username" class="block text-sm font-medium text-gray-700 mb-1">اسم المستخدم</label>
                <input type="text" id="username" name="username" required
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500"
                       placeholder="ادخل اسم المستخدم">
            </div>
            <div class="mb-6">
                <label for="password" class="block text-sm font-medium text-gray-700 mb-1">كلمة المرور</label>
                <input type="password" id="password" name="password" required
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500"
                       placeholder="ادخل كلمة المرور">
            </div>
            <div id="loginErrorMessage" class="error-message p-3 rounded-lg mb-4 hidden">
                اسم المستخدم أو كلمة المرور غير صحيحة.
            </div>
            <button type="submit"
                    class="w-full login-button text-white font-semibold py-3 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-600 focus:ring-opacity-50">
                تسجيل الدخول
            </button>
        </form>
    </section>

    <section id="admin-panel-section" class="hidden w-full h-full">
        <aside id="sidebar" class="sidebar w-64 min-h-screen p-4 space-y-2 flex flex-col fixed top-0 right-0 h-full z-40 lg:relative lg:translate-x-0 transform translate-x-full">
            <div class="flex items-center justify-between pb-4 border-b border-gray-700">
                <div class="flex items-center">
                    <img src="https://placehold.co/40x40/F97316/FFFFFF?text=Z" alt="Zack's Logo" class="h-10 w-10 rounded-full">
                    <h1 id="brandNameSidebar" class="text-2xl font-bold text-white ml-3 sidebar-text">Zack's</h1>
                </div>
                <button id="sidebarToggleDesktop" class="hidden lg:block text-gray-400 hover:text-white p-1">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <nav class="flex-grow">
                <a href="#dashboard" data-section="dashboard" class="sidebar-link active flex items-center py-2.5 px-4 rounded-md">
                    <i class="fas fa-tachometer-alt w-6 text-center mr-3"></i>
                    <span class="sidebar-text">لوحة المعلومات</span>
                </a>
                <a href="#items" data-section="items" class="sidebar-link flex items-center py-2.5 px-4 rounded-md">
                    <i class="fas fa-hamburger w-6 text-center mr-3"></i>
                    <span class="sidebar-text">إدارة الأصناف</span>
                </a>
                <a href="#orders" data-section="orders" class="sidebar-link flex items-center py-2.5 px-4 rounded-md">
                    <i class="fas fa-receipt w-6 text-center mr-3"></i>
                    <span class="sidebar-text">إدارة الطلبات</span>
                </a>
                <a href="#reports" data-section="reports" class="sidebar-link flex items-center py-2.5 px-4 rounded-md">
                    <i class="fas fa-chart-line w-6 text-center mr-3"></i>
                    <span class="sidebar-text">تقارير المبيعات</span>
                </a>
                <a href="#expenses" data-section="expenses" class="sidebar-link flex items-center py-2.5 px-4 rounded-md">
                    <i class="fas fa-file-invoice-dollar w-6 text-center mr-3"></i>
                    <span class="sidebar-text">المصروفات</span>
                </a>
                <a href="#settings" data-section="settings" class="sidebar-link flex items-center py-2.5 px-4 rounded-md">
                    <i class="fas fa-cog w-6 text-center mr-3"></i>
                    <span class="sidebar-text">الإعدادات</span>
                </a>
            </nav>
            <div class="pt-4 border-t border-gray-700">
                <a href="#" id="adminLogoutBtn" class="sidebar-link flex items-center py-2.5 px-4 rounded-md">
                    <i class="fas fa-sign-out-alt w-6 text-center mr-3"></i>
                    <span class="sidebar-text">تسجيل الخروج</span>
                </a>
            </div>
        </aside>

        <div id="mainContent" class="flex-1 flex flex-col overflow-hidden lg:mr-64">
            <header class="bg-white shadow-sm h-16 flex items-center justify-between px-6">
                <div class="flex items-center">
                    <button id="sidebarToggleMobile" class="lg:hidden text-gray-600 hover:text-orange-600 mr-4 text-xl">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h2 id="pageTitle" class="text-xl font-semibold text-gray-700">لوحة المعلومات الرئيسية</h2>
                </div>
                <div class="flex items-center space-x-reverse space-x-3">
                    <i class="fas fa-user-shield text-orange-500 text-2xl"></i>
                    <span id="loggedInUserType" class="text-sm text-gray-600">مدير النظام</span>
                </div>
            </header>

            <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-6 main-content-scroll">
                <section id="dashboard-content" class="content-section">
                    <div class="mb-6 bg-white p-4 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-gray-700 mb-3">تحديد فترة العرض</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-4 items-end">
                            <div>
                                <label for="globalFilterDateFrom" class="block text-sm font-medium text-gray-600 mb-1">من تاريخ:</label>
                                <input type="date" id="globalFilterDateFrom" class="p-2 border border-gray-300 rounded-md text-sm w-full focus:ring-orange-500 focus:border-orange-500">
                            </div>
                            <div>
                                <label for="globalFilterTimeFrom" class="block text-sm font-medium text-gray-600 mb-1">من وقت:</label>
                                <input type="time" id="globalFilterTimeFrom" class="p-2 border border-gray-300 rounded-md text-sm w-full focus:ring-orange-500 focus:border-orange-500">
                            </div>
                            <div>
                                <label for="globalFilterDateTo" class="block text-sm font-medium text-gray-600 mb-1">إلى تاريخ:</label>
                                <input type="date" id="globalFilterDateTo" class="p-2 border border-gray-300 rounded-md text-sm w-full focus:ring-orange-500 focus:border-orange-500">
                            </div>
                            <div>
                                <label for="globalFilterTimeTo" class="block text-sm font-medium text-gray-600 mb-1">إلى وقت:</label>
                                <input type="time" id="globalFilterTimeTo" class="p-2 border border-gray-300 rounded-md text-sm w-full focus:ring-orange-500 focus:border-orange-500">
                            </div>
                            <button id="applyGlobalFiltersBtn" class="bg-orange-500 hover:bg-orange-600 text-white text-sm font-medium py-2.5 px-4 rounded-md w-full sm:w-auto md:mt-0 mt-4 h-10">
                                <i class="fas fa-filter mr-1"></i> تطبيق
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                        <div class="stat-card stat-card-primary md:col-span-2 lg:col-span-1">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium">إجمالي المبيعات (الفترة المحددة)</p>
                                    <p id="dashboardTotalSales" class="text-3xl font-bold">0 جنيه</p>
                                </div>
                                <i class="fas fa-dollar-sign text-4xl opacity-75"></i>
                            </div>
                        </div>
                        <div class="stat-card stat-card-secondary">
                            <p class="text-sm font-medium mb-1">عدد الطلبات (الفترة المحددة)</p>
                            <p id="dashboardTotalOrders" class="text-3xl font-bold mb-2">0</p>
                            <div class="text-xs space-y-1">
                                <div class="flex justify-between"><span>كاش:</span> <span id="dashboardCashOrders">0 طلبات (بقيمة 0 جنيه)</span></div>
                                <div class="flex justify-between"><span>فيزا:</span> <span id="dashboardCardOrders">0 طلبات (بقيمة 0 جنيه)</span></div>
                            </div>
                        </div>
                         <div class="stat-card stat-card-secondary">
                            <p class="text-sm font-medium mb-1">الصنف الأكثر مبيعاً (الفترة المحددة)</p>
                            <p id="dashboardTopItem" class="text-xl font-bold">-</p>
                            <p class="text-xs mt-1">مرات البيع: <span id="dashboardTopItemSales">0 مرة</span></p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold mb-4 text-gray-700">مؤشرات الأداء (مقارنة)</h3>
                            <ul class="space-y-3">
                               <li class="flex justify-between items-center py-1">
                                    <span class="text-sm text-gray-700">المبيعات (مقابل الفترة السابقة):</span>
                                    <span id="dashboardSalesComparison" class="text-sm font-semibold">-%</span>
                                </li>
                                 <li class="flex justify-between items-center py-1">
                                    <span class="text-sm text-gray-700">عدد الطلبات (مقابل الفترة السابقة):</span>
                                    <span id="dashboardOrdersComparison" class="text-sm font-semibold">-%</span>
                                </li>
                                <li class="flex justify-between items-center py-1">
                                    <span class="text-sm text-gray-700">متوسط وقت تجهيز الطلب:</span>
                                    <span id="dashboardAvgPrepTime" class="text-sm font-semibold text-orange-600">- دقيقة</span>
                                </li>
                            </ul>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold mb-4 text-gray-700">ملخص سريع آخر</h3>
                            <ul class="space-y-3">
                               <li class="flex justify-between items-center py-1">
                                    <span class="text-sm text-gray-700">متوسط قيمة الطلب:</span>
                                    <span id="dashboardAvgOrderValue" class="text-sm font-semibold text-orange-600">0 جنيه</span>
                                </li>
                                 <li class="flex justify-between items-center py-1">
                                    <span class="text-sm text-gray-700">إجمالي المصروفات (الفترة المحددة):</span>
                                    <span id="dashboardTotalExpenses" class="text-sm font-semibold text-red-600">0 جنيه</span>
                                </li>
                                <li class="flex justify-between items-center py-1">
                                    <span class="text-sm text-gray-700">صافي الربح (تقريبي):</span>
                                    <span id="dashboardNetProfit" class="text-sm font-semibold text-green-600">0 جنيه</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
                        <div class="flex flex-wrap justify-between items-center mb-4 gap-4">
                            <h3 class="text-lg font-semibold text-gray-700">الطلبات الأخيرة (ضمن الفترة المحددة)</h3>
                             <div class="flex flex-wrap gap-2 items-center">
                                <input type="date" id="filterDateFrom" class="p-2 border border-gray-300 rounded-md text-sm focus:ring-orange-500 focus:border-orange-500">
                                <span class="text-gray-500 text-sm">إلى</span>
                                <input type="date" id="filterDateTo" class="p-2 border border-gray-300 rounded-md text-sm focus:ring-orange-500 focus:border-orange-500">
                                <input type="time" id="filterTimeFrom" class="p-2 border border-gray-300 rounded-md text-sm focus:ring-orange-500 focus:border-orange-500">
                                <span class="text-gray-500 text-sm">إلى</span>
                                <input type="time" id="filterTimeTo" class="p-2 border border-gray-300 rounded-md text-sm focus:ring-orange-500 focus:border-orange-500">
                                <button id="applyFiltersBtn" class="bg-orange-500 hover:bg-orange-600 text-white text-sm font-medium py-2 px-3 rounded-md"><i class="fas fa-filter mr-1"></i> تطبيق</button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead>
                                    <tr>
                                        <th class="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">رقم الطلب</th>
                                        <th class="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">الوقت</th>
                                        <th class="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">النوع</th>
                                        <th class="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">الإجمالي</th>
                                        <th class="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">الحالة</th>
                                        <th class="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">الكاشير</th>
                                    </tr>
                                </thead>
                                <tbody id="recentOrdersTableBody" class="bg-white divide-y divide-gray-200">
                                 </tbody>
                            </table>
                        </div>
                         <div id="paginationControls" class="mt-4 flex justify-center items-center space-x-reverse space-x-2 text-sm">
                         </div>
                    </div>
                </section>

                <section id="items-content" class="content-section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-semibold text-gray-700">إدارة الأصناف</h3>
                        <button id="addItemBtnPage" class="bg-orange-500 hover:bg-orange-600 text-white font-medium py-2 px-4 rounded-lg shadow-md hover:shadow-lg transition duration-150 ease-in-out">
                            <i class="fas fa-plus mr-2"></i> إضافة صنف جديد
                        </button>
                    </div>
                    <div class="mb-6 bg-white p-4 rounded-lg shadow">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                            <div>
                                <label for="searchItemName" class="block text-sm font-medium text-gray-700 mb-1">البحث بالاسم:</label>
                                <input type="text" id="searchItemName" placeholder="ادخل اسم الصنف..." class="w-full p-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500">
                            </div>
                            <div>
                                <label for="filterItemCategory" class="block text-sm font-medium text-gray-700 mb-1">فلترة بالفئة:</label>
                                <select id="filterItemCategory" class="w-full p-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500">
                                    <option value="">كل الفئات</option>
                                </select>
                            </div>
                            <button id="applyItemFiltersBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2.5 px-4 rounded-md h-10"><i class="fas fa-search mr-1"></i> بحث/فلترة</button>
                        </div>
                    </div>
                    <div class="overflow-x-auto bg-white rounded-lg shadow">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">الصنف</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">الفئة</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">السعر</th>
                                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">الحالة</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">إجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="itemsTableBody" class="bg-white divide-y divide-gray-200">
                            </tbody>
                        </table>
                    </div>
                     <div id="itemsPaginationControls" class="mt-4 flex justify-center items-center space-x-reverse space-x-2 text-sm">
                    </div>
                </section>

                <section id="orders-content" class="content-section hidden">
                    <h3 class="text-2xl font-semibold text-gray-700 mb-6">إدارة الطلبات</h3>
                    <div class="mb-6 bg-white p-4 rounded-lg shadow">
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 items-end">
                            <div>
                                <label for="searchDetailedOrderIdInput" class="block text-sm font-medium text-gray-700 mb-1">بحث برقم الطلب:</label>
                                <input type="text" id="searchDetailedOrderIdInput" placeholder="ادخل رقم الطلب..." class="w-full p-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500">
                            </div>
                            <div>
                                <label for="filterDetailedOrderStatus" class="block text-sm font-medium text-gray-700 mb-1">فلترة بالحالة:</label>
                                <select id="filterDetailedOrderStatus" class="w-full p-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500">
                                    <option value="">كل الحالات</option>
                                    <option value="قيد التجهيز">قيد التجهيز</option>
                                    <option value="مكتمل">مكتمل</option>
                                    <option value="ملغي">ملغي</option>
                                    <option value="جاهز للاستلام">جاهز للاستلام</option>
                                </select>
                            </div>
                            <div>
                                <label for="filterDetailedOrderDate" class="block text-sm font-medium text-gray-700 mb-1">فلترة بالتاريخ:</label>
                                <input type="date" id="filterDetailedOrderDate" class="w-full p-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500">
                            </div>
                            <button id="applyDetailedOrderFiltersBtn" class="bg-orange-500 hover:bg-orange-600 text-white font-medium py-2.5 px-4 rounded-md h-10"><i class="fas fa-filter mr-1"></i> تطبيق الفلاتر</button>
                        </div>
                    </div>
                    <div class="overflow-x-auto bg-white rounded-lg shadow">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">رقم الطلب</th>
                                    <th class="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">التاريخ والوقت</th>
                                    <th class="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">العميل</th>
                                    <th class="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">النوع</th>
                                    <th class="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">الإجمالي</th>
                                    <th class="px-4 py-3 text-center text-xs font-medium uppercase tracking-wider">الحالة</th>
                                    <th class="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">الكاشير</th>
                                    <th class="px-4 py-3 text-center text-xs font-medium uppercase tracking-wider">إجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="detailedOrdersTableBody" class="bg-white divide-y divide-gray-200">
                            </tbody>
                        </table>
                    </div>
                    <div id="detailedOrdersPaginationControls" class="mt-4 flex justify-center items-center space-x-reverse space-x-2 text-sm">
                    </div>
                </section>

                <section id="reports-content" class="content-section hidden">
                    <h3 class="text-2xl font-semibold text-gray-700 mb-6">تقارير المبيعات والأداء</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="report-card">
                            <i class="fas fa-file-invoice-dollar"></i><h4>ملخص المبيعات</h4>
                            <p class="text-sm text-gray-600 mb-3">عرض إجمالي المبيعات، عدد الطلبات، ومتوسط قيمة الطلب لفترات محددة.</p>
                            <p class="coming-soon">قريباً</p>
                        </div>
                        <div class="report-card">
                            <i class="fas fa-tags"></i><h4>المبيعات حسب الصنف/الفئة</h4>
                            <p class="text-sm text-gray-600 mb-3">تحليل الأصناف والفئات الأكثر مبيعاً والأقل مبيعاً.</p>
                            <p class="coming-soon">قريباً</p>
                        </div>
                        <div class="report-card">
                            <i class="fas fa-credit-card"></i><h4>المبيعات حسب طريقة الدفع</h4>
                            <p class="text-sm text-gray-600 mb-3">توزيع المبيعات بناءً على طرق الدفع المستخدمة.</p>
                            <p class="coming-soon">قريباً</p>
                        </div>
                        <div class="report-card">
                            <i class="fas fa-chart-pie"></i><h4>اتجاهات المبيعات</h4>
                            <p class="text-sm text-gray-600 mb-3">رسوم بيانية توضح أداء المبيعات.</p>
                            <p class="coming-soon">قريباً</p>
                        </div>
                        <div class="report-card">
                            <i class="fas fa-users"></i><h4>تقارير العملاء</h4>
                            <p class="text-sm text-gray-600 mb-3">تحليل سلوك العملاء.</p>
                            <p class="coming-soon">قريباً</p>
                        </div>
                         <div class="report-card">
                            <i class="fas fa-file-export"></i><h4>تصدير التقارير</h4>
                            <p class="text-sm text-gray-600 mb-3">إمكانية تصدير البيانات.</p>
                            <p class="coming-soon">قريباً</p>
                        </div>
                    </div>
                </section>

                <section id="expenses-content" class="content-section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-semibold text-gray-700">إدارة المصروفات</h3>
                        <button id="addExpenseBtn" class="bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-4 rounded-lg shadow-md">
                            <i class="fas fa-plus mr-2"></i> إضافة مصروف جديد
                        </button>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow text-center py-8">
                        <i class="fas fa-folder-open fa-3x mb-3 text-gray-400"></i>
                        <p class="text-gray-600">سيتم هنا عرض جدول المصروفات (قيد التطوير).</p>
                    </div>
                </section>
                <section id="settings-content" class="content-section hidden">
                     <h3 class="text-2xl font-semibold text-gray-700 mb-6">الإعدادات العامة</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h4 class="text-lg font-semibold text-gray-800 mb-3">إعدادات المطعم</h4>
                            <p class="text-gray-600">اسم المطعم، العنوان، إلخ.</p>
                            <button class="mt-3 bg-gray-200 text-gray-700 py-2 px-3 rounded-md text-sm hover:bg-gray-300">تعديل (قريباً)</button>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h4 class="text-lg font-semibold text-gray-800 mb-3">إعدادات الحساب</h4>
                            <p class="text-gray-600">تغيير كلمة المرور.</p>
                            <button class="mt-3 bg-gray-200 text-gray-700 py-2 px-3 rounded-md text-sm hover:bg-gray-300">تعديل (قريباً)</button>
                        </div>
                         <div class="bg-white p-6 rounded-lg shadow">
                            <h4 class="text-lg font-semibold text-gray-800 mb-3">إدارة الفئات</h4>
                            <p class="text-gray-600">إدارة فئات الأصناف.</p>
                            <button class="mt-3 bg-gray-200 text-gray-700 py-2 px-3 rounded-md text-sm hover:bg-gray-300">إدارة (قريباً)</button>
                        </div>
                    </div>
                </section>
            </main>
        </div>
        
        <div id="itemModal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden opacity-0 z-50">
            <div class="modal-content bg-white p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-lg transform scale-95 max-h-[90vh] flex flex-col">
                <div class="flex justify-between items-center mb-6 pb-3 border-b">
                    <h3 id="modalTitle" class="text-xl font-semibold text-gray-800">إضافة صنف جديد</h3>
                    <button id="closeItemModalBtn" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>
                <form id="itemForm" class="flex-grow overflow-y-auto pr-2 space-y-4">
                    <input type="hidden" id="itemIdInput">
                    <div>
                        <label for="itemNameInput" class="block text-sm font-medium text-gray-700 mb-1">اسم الصنف <span class="text-red-500">*</span></label>
                        <input type="text" id="itemNameInput" name="itemName" required class="w-full p-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500">
                    </div>
                    <div>
                        <label for="itemCategorySelect" class="block text-sm font-medium text-gray-700 mb-1">الفئة <span class="text-red-500">*</span></label>
                        <select id="itemCategorySelect" name="itemCategory" required class="w-full p-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500">
                        </select>
                    </div>
                    <div>
                        <label for="itemPriceInput" class="block text-sm font-medium text-gray-700 mb-1">السعر (جنيه) <span class="text-red-500">*</span></label>
                        <input type="number" id="itemPriceInput" name="itemPrice" step="0.01" min="0" required class="w-full p-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500">
                    </div>
                    <div>
                        <label for="itemDescriptionInput" class="block text-sm font-medium text-gray-700 mb-1">الوصف (اختياري)</label>
                        <textarea id="itemDescriptionInput" name="itemDescription" rows="3" class="w-full p-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500"></textarea>
                    </div>
                    <div>
                        <label for="itemImageInput" class="block text-sm font-medium text-gray-700 mb-1">رابط الصورة (اختياري)</label>
                        <input type="url" id="itemImageInput" name="itemImage" placeholder="https://example.com/image.jpg" class="w-full p-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500">
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="itemIsAvailableInput" name="isAvailable" class="h-4 w-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500">
                        <label for="itemIsAvailableInput" class="ml-2 block text-sm text-gray-900">متاح للبيع</label>
                    </div>
                </form>
                <div class="flex justify-end gap-3 pt-6 mt-auto border-t">
                    <button type="button" id="cancelItemFormBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-4 rounded-lg text-sm">إلغاء</button>
                    <button type="submit" form="itemForm" class="bg-orange-500 hover:bg-orange-600 text-white font-medium py-2 px-4 rounded-lg text-sm">حفظ الصنف</button>
                </div>
            </div>
        </div>
        
        <div id="orderDetailsModal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden opacity-0 z-50">
            <div class="modal-content bg-white p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-2xl transform scale-95 max-h-[90vh] flex flex-col">
                <div class="flex justify-between items-center mb-4 pb-3 border-b">
                    <h3 id="orderDetailsModalTitle" class="text-xl font-semibold text-gray-800">تفاصيل الطلب رقم: </h3>
                    <button id="closeOrderDetailsModalBtn" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>
                <div id="orderDetailsModalBody" class="overflow-y-auto flex-grow">
                </div>
                <div class="flex justify-end gap-3 pt-4 mt-auto border-t">
                     <button type="button" id="printOrderDetailsBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg text-sm"><i class="fas fa-print mr-1"></i> طباعة هذا الإيصال</button>
                    <button type="button" id="cancelOrderDetailsModalBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-4 rounded-lg text-sm">إغلاق</button>
                </div>
            </div>
        </div>
    </section>

    <section id="cashier-panel-section" class="hidden w-full h-full flex flex-col">
        <header class="cashier-header h-16 flex items-center justify-between px-6 shadow-md">
            <div class="flex items-center">
                <img src="https://placehold.co/40x40/F97316/FFFFFF?text=Z" alt="Zack's Logo" class="h-10 w-10 rounded-full mr-3">
                <h2 class="text-xl font-semibold">نقطة بيع Zack's (الكاشير)</h2>
            </div>
            <div class="flex items-center space-x-reverse space-x-3">
                <i class="fas fa-cash-register text-orange-400 text-2xl"></i>
                <span id="cashierLoggedInUser" class="text-sm">الكاشير: </span>
                <button id="cashierLogoutBtn" class="bg-red-500 hover:bg-red-600 text-white text-xs font-medium py-2 px-3 rounded-md">
                    <i class="fas fa-sign-out-alt mr-1"></i> تسجيل الخروج
                </button>
            </div>
        </header>
        <main class="flex-1 bg-gray-100 cashier-content">
            <h3 class="text-3xl font-semibold text-gray-700 mb-4">مرحباً بك في واجهة الكاشير</h3>
            <p class="text-gray-600 mb-8">هنا سيتم عرض وظائف الكاشير مثل إضافة الطلبات، إدارة الطاولات، إلخ.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300">
                    <i class="fas fa-plus-circle text-4xl text-orange-500 mb-3"></i>
                    <h4 class="text-xl font-semibold mb-2">طلب جديد</h4>
                    <p class="text-sm text-gray-500">بدء عملية طلب جديدة للعميل.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300">
                    <i class="fas fa-concierge-bell text-4xl text-orange-500 mb-3"></i>
                    <h4 class="text-xl font-semibold mb-2">إدارة الطاولات</h4>
                    <p class="text-sm text-gray-500">عرض حالة الطاولات وإدارتها (للطلبات الداخلية).</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300">
                    <i class="fas fa-history text-4xl text-orange-500 mb-3"></i>
                    <h4 class="text-xl font-semibold mb-2">الطلبات الحالية</h4>
                    <p class="text-sm text-gray-500">متابعة الطلبات قيد التجهيز أو التوصيل.</p>
                </div>
            </div>
             <p class="mt-10 text-sm text-gray-500">(هذه الواجهة قيد التطوير)</p>
        </main>
    </section>


    <script>
        // --- DOM Elements ---
        const loginSection = document.getElementById('login-section');
        const adminPanelSection = document.getElementById('admin-panel-section');
        const cashierPanelSection = document.getElementById('cashier-panel-section');
        const loginForm = document.getElementById('loginForm');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const loginErrorMessage = document.getElementById('loginErrorMessage');
        const adminLogoutBtn = document.getElementById('adminLogoutBtn');
        const cashierLogoutBtn = document.getElementById('cashierLogoutBtn');
        const loggedInUserTypeEl = document.getElementById('loggedInUserType');
        const cashierLoggedInUserEl = document.getElementById('cashierLoggedInUser');

        // Admin Panel Specific DOM Elements
        const sidebar = document.getElementById('sidebar'); // Already declared for admin panel
        const mainContent = document.getElementById('mainContent'); // Already declared for admin panel
        const sidebarToggleDesktop = document.getElementById('sidebarToggleDesktop'); // Already declared
        const sidebarToggleMobile = document.getElementById('sidebarToggleMobile'); // Already declared
        const pageTitle = document.getElementById('pageTitle'); // Already declared
        const contentSections = document.querySelectorAll('#admin-panel-section .content-section');
        const sidebarLinks = document.querySelectorAll('#admin-panel-section .sidebar-link');
        let isSidebarCollapsed = false;

        // Item Management Page Elements
        const addItemBtnPage = document.getElementById('addItemBtnPage');
        const itemsTableBody = document.getElementById('itemsTableBody');
        const searchItemNameInput = document.getElementById('searchItemName');
        const filterItemCategorySelect = document.getElementById('filterItemCategory');
        const applyItemFiltersBtn = document.getElementById('applyItemFiltersBtn');
        
        // Item Modal Elements
        const itemModal = document.getElementById('itemModal'); // Already declared
        const closeItemModalBtn = document.getElementById('closeItemModalBtn');
        const cancelItemFormBtn = document.getElementById('cancelItemFormBtn');
        const itemForm = document.getElementById('itemForm'); // Already declared
        const modalTitle = document.getElementById('modalTitle'); // Already declared
        const itemCategorySelect = document.getElementById('itemCategorySelect'); 
        const itemIdInput = document.getElementById('itemIdInput');
        const itemNameInput = document.getElementById('itemNameInput');
        const itemPriceInput = document.getElementById('itemPriceInput');
        const itemDescriptionInput = document.getElementById('itemDescriptionInput');
        const itemImageInput = document.getElementById('itemImageInput');
        const itemIsAvailableInput = document.getElementById('itemIsAvailableInput');

        // Dashboard elements
        const dashboardTotalSalesEl = document.getElementById('dashboardTotalSales');
        const dashboardTotalOrdersEl = document.getElementById('dashboardTotalOrders');
        const dashboardCashOrdersEl = document.getElementById('dashboardCashOrders');
        const dashboardCardOrdersEl = document.getElementById('dashboardCardOrders');
        const dashboardTopItemEl = document.getElementById('dashboardTopItem');
        const dashboardTopItemSalesEl = document.getElementById('dashboardTopItemSales');
        const dashboardAvgOrderValueEl = document.getElementById('dashboardAvgOrderValue');
        const recentOrdersTableBodyEl = document.getElementById('recentOrdersTableBody');
        const dashboardSalesComparisonEl = document.getElementById('dashboardSalesComparison');
        const dashboardOrdersComparisonEl = document.getElementById('dashboardOrdersComparison');
        const dashboardAvgPrepTimeEl = document.getElementById('dashboardAvgPrepTime');
        const dashboardTotalExpenses = document.getElementById('dashboardTotalExpenses'); // Added
        const dashboardNetProfit = document.getElementById('dashboardNetProfit'); // Added
        
        // Global Dashboard Filters
        const globalFilterDateFromInput = document.getElementById('globalFilterDateFrom');
        const globalFilterTimeFromInput = document.getElementById('globalFilterTimeFrom');
        const globalFilterDateToInput = document.getElementById('globalFilterDateTo');
        const globalFilterTimeToInput = document.getElementById('globalFilterTimeTo');
        const applyGlobalFiltersBtn = document.getElementById('applyGlobalFiltersBtn');

        // Order Details Modal Elements
        const orderDetailsModal = document.getElementById('orderDetailsModal'); // Already declared
        const orderDetailsModalTitle = document.getElementById('orderDetailsModalTitle');
        const orderDetailsModalBody = document.getElementById('orderDetailsModalBody');
        const closeOrderDetailsModalBtn = document.getElementById('closeOrderDetailsModalBtn'); // Already declared
        const cancelOrderDetailsModalBtn = document.getElementById('cancelOrderDetailsModalBtn');
        const printOrderDetailsBtn = document.getElementById('printOrderDetailsBtn');
        
        // Filters for Recent Orders Table (Dashboard)
        const filterDateFromInput = document.getElementById('filterDateFrom');
        const filterDateToInput = document.getElementById('filterDateTo');
        const filterTimeFromInput = document.getElementById('filterTimeFrom');
        const filterTimeToInput = document.getElementById('filterTimeTo');
        const applyFiltersBtn = document.getElementById('applyFiltersBtn');

        // Detailed Orders Page Elements
        const searchDetailedOrderIdInput = document.getElementById('searchDetailedOrderIdInput');
        const filterDetailedOrderStatusSelect = document.getElementById('filterDetailedOrderStatus');
        const filterDetailedOrderDateInput = document.getElementById('filterDetailedOrderDate');
        const applyDetailedOrderFiltersBtn = document.getElementById('applyDetailedOrderFiltersBtn');
        const detailedOrdersTableBody = document.getElementById('detailedOrdersTableBody');
        const detailedOrdersPaginationControls = document.getElementById('detailedOrdersPaginationControls');
        const itemsPaginationControls = document.getElementById('itemsPaginationControls'); // Added
        const paginationControls = document.getElementById('paginationControls'); // Added for dashboard recent orders

        // --- Data (Sample - To be replaced by API calls) ---
        const initialCategories = [
            { id: 'chicken-meals', name: 'وجبات دجاج' }, { id: 'chicken-sandwiches', name: 'ساندوتشات دجاج' },
            { id: 'sides', name: 'أطباق جانبية' }, { id: 'sauces', name: 'صوصات' }, { id: 'drinks', name: 'مشروبات' },
        ];
        let itemsData = [
            { id: 1, name: 'وجبة دجاج (3 قطع)', category: 'chicken-meals', price: 75.00, description: '3 قطع دجاج مقلي مع بطاطس وكولسلو', image_url: 'https://placehold.co/100x70/F97316/FFF?text=3+قطع', is_available: true },
            { id: 2, name: 'ساندوتش كرسبي رول', category: 'chicken-sandwiches', price: 60.00, description: 'ساندوتش دجاج كرسبي مع صوص خاص', image_url: 'https://placehold.co/100x70/FB923C/333?text=كرسبي', is_available: true },
            { id: 3, name: 'بطاطس Zack\'s', category: 'sides', price: 25.00, description: 'بطاطس مقلية بتتبيلة Zack\'s الخاصة', image_url: 'https://placehold.co/100x70/FFD700/333?text=بطاطس', is_available: false },
            { id: 4, name: 'بيبسي', category: 'drinks', price: 15.00, description: '', image_url: 'https://placehold.co/100x70/4682B4/FFF?text=بيبسي', is_available: true },
        ];
        const dummyRecentOrders = Array.from({length: 15}, (_, i) => ({ 
            id: `ZCK${String(1001 + i).padStart(3, '0')}`, 
            dateTime: new Date(Date.now() - i * 3600000 - Math.random()*3600000).toISOString(),
            type: Math.random() > 0.5 ? 'صالة' : 'تيك أواي', 
            total: parseFloat((Math.random() * 200 + 50).toFixed(2)), 
            status: i % 3 === 0 ? 'قيد التجهيز' : (i % 3 === 1 ? 'ملغي' : 'مكتمل'),
            cashier: 'أحمد',
            paymentMethod: Math.random() > 0.4 ? 'كاش' : 'فيزا',
            items: [ {name: itemsData[0].name, quantity: 1, price: itemsData[0].price} ],
        }));
        const dummyDetailedOrders = Array.from({length: 25}, (_, i) => { 
            const statuses = ['قيد التجهيز', 'مكتمل', 'ملغي', 'جاهز للاستلام'];
            return {
                id: `ORD${String(2001 + i).padStart(4, '0')}`,
                dateTime: new Date(Date.now() - i * 2 * 3600000 - Math.random()*7200000).toISOString(),
                customerName: `زبون ${200+i}`, type: 'صالة',
                total: parseFloat((Math.random() * 300 + 70).toFixed(2)),
                status: statuses[i % statuses.length], cashier: 'سارة',
                paymentMethod: 'فيزا', items: [{name: itemsData[1].name, quantity: 2, price: itemsData[1].price}],
            };
        });


        // --- Login and Page Switching Logic ---
        if (loginForm) {
            loginForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const username = usernameInput.value.trim();
                const password = passwordInput.value.trim();

                if (username === 'admin' && password === 'admin123') {
                    loginSection.classList.add('hidden');
                    loginSection.classList.remove('block');
                    
                    adminPanelSection.classList.remove('hidden');
                    adminPanelSection.classList.add('app-shell-visible'); 
                    document.body.style.alignItems = ''; 
                    document.body.style.justifyContent = '';
                    if(loggedInUserTypeEl) loggedInUserTypeEl.textContent = 'مدير النظام: admin';
                    initializeAdminPanel(); 
                } 
                else if (username === 'cashier' && password === 'cashier123') {
                    loginSection.classList.add('hidden');
                    loginSection.classList.remove('block');

                    cashierPanelSection.classList.remove('hidden');
                    cashierPanelSection.classList.add('app-shell-visible'); 
                    document.body.style.alignItems = ''; 
                    document.body.style.justifyContent = '';
                    if(cashierLoggedInUserEl) cashierLoggedInUserEl.textContent = 'الكاشير: cashier';
                } 
                else {
                    if(loginErrorMessage) loginErrorMessage.classList.remove('hidden');
                }
            });
        }

        function logout() {
            if(adminPanelSection) {
                adminPanelSection.classList.add('hidden');
                adminPanelSection.classList.remove('app-shell-visible');
            }
            if(cashierPanelSection) {
                cashierPanelSection.classList.add('hidden');
                cashierPanelSection.classList.remove('app-shell-visible');
            }
            
            if(loginSection) {
                loginSection.classList.remove('hidden');
                loginSection.classList.add('block');
            }
            document.body.style.alignItems = 'center'; 
            document.body.style.justifyContent = 'center';

            if (usernameInput) usernameInput.value = '';
            if (passwordInput) passwordInput.value = '';
            if (loginErrorMessage) loginErrorMessage.classList.add('hidden');
        }

        if (adminLogoutBtn) adminLogoutBtn.addEventListener('click', logout);
        if (cashierLogoutBtn) cashierLogoutBtn.addEventListener('click', logout);


        // --- Admin Panel Specific Functions ---
        function initializeAdminPanel() {
            const dashboardLinkAdmin = document.querySelector('#admin-panel-section a[data-section="dashboard"]');
            if (dashboardLinkAdmin) {
                const dashboardContentAdmin = document.getElementById('dashboard-content'); // Scoped
                if (pageTitle && dashboardLinkAdmin.querySelector('.sidebar-text')) {
                     pageTitle.textContent = dashboardLinkAdmin.querySelector('.sidebar-text').textContent;
                }
                // Ensure all admin content sections are correctly hidden/shown
                document.querySelectorAll('#admin-panel-section .content-section').forEach(s => s.classList.add('hidden'));

                if(dashboardContentAdmin) dashboardContentAdmin.classList.remove('hidden');
                
                document.querySelectorAll('#admin-panel-section .sidebar-link').forEach(s_link => s_link.classList.remove('active'));
                dashboardLinkAdmin.classList.add('active');
            }
            populateDashboard(); 
        }

        if (sidebarToggleDesktop) sidebarToggleDesktop.addEventListener('click', toggleSidebarAdmin);
        if (sidebarToggleMobile) sidebarToggleMobile.addEventListener('click', () => {
            if(sidebar) sidebar.classList.toggle('translate-x-full');
        });

        function toggleSidebarAdmin() { 
            isSidebarCollapsed = !isSidebarCollapsed;
            if(sidebar) {
                sidebar.classList.toggle('w-64', !isSidebarCollapsed);
                sidebar.classList.toggle('w-20', isSidebarCollapsed);
                sidebar.classList.toggle('sidebar-collapsed', isSidebarCollapsed);
            }
            if(mainContent) { // Ensure mainContent is specific to admin panel if cashier has one too
                const adminMainContent = document.querySelector('#admin-panel-section #mainContent');
                if (adminMainContent) {
                    adminMainContent.classList.toggle('lg:mr-64', !isSidebarCollapsed);
                    adminMainContent.classList.toggle('lg:mr-20', isSidebarCollapsed);
                }
            }
            const adminSidebarToggleDesktop = document.querySelector('#admin-panel-section #sidebarToggleDesktop');
            if(adminSidebarToggleDesktop) {
                const chevronIcon = adminSidebarToggleDesktop.querySelector('i');
                if(chevronIcon) {
                    chevronIcon.classList.toggle('fa-chevron-right', !isSidebarCollapsed);
                    chevronIcon.classList.toggle('fa-chevron-left', isSidebarCollapsed);
                }
            }
        }
        
        // Ensure sidebarLinks are correctly scoped for Admin Panel
        document.querySelectorAll('#admin-panel-section .sidebar-link').forEach(link => {
            link.addEventListener('click', (e) => {
                const sectionId = link.dataset.section;
                if (!sectionId) return;
                e.preventDefault();
                const linkTextEl = link.querySelector('.sidebar-text');
                const adminPageTitle = document.querySelector('#admin-panel-section #pageTitle');
                if (adminPageTitle && linkTextEl) adminPageTitle.textContent = linkTextEl.textContent;
                
                document.querySelectorAll('#admin-panel-section .content-section').forEach(section => section.classList.add('hidden'));
                const targetSection = document.querySelector(`#admin-panel-section #${sectionId}-content`); //Scoped selector
                if (targetSection) targetSection.classList.remove('hidden');
                
                document.querySelectorAll('#admin-panel-section .sidebar-link').forEach(s_link => s_link.classList.remove('active'));
                link.classList.add('active');
                
                const adminSidebar = document.querySelector('#admin-panel-section #sidebar');
                if (window.innerWidth < 1024 && adminSidebar && !adminSidebar.classList.contains('translate-x-full')) {
                    adminSidebar.classList.add('translate-x-full');
                }

                if (sectionId === 'items') {
                    populateFilterItemCategorySelect(); 
                    renderItemsTable(); 
                } else if (sectionId === 'dashboard') {
                    populateDashboard();
                } else if (sectionId === 'orders') {
                    populateDetailedOrderStatusFilter();
                    renderDetailedOrdersTable();
                }
            });
        });
        
        // --- Utility Functions (Shared by Admin Panel) ---
        function formatOrderDateTime(isoDateTime) { 
            if (!isoDateTime) return 'غير محدد';
            const date = new Date(isoDateTime);
            return `${date.toLocaleDateString('ar-EG')} ${date.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' })}`;
        }
        function getStatusClass(status) { 
            switch (status) {
                case 'مكتمل': case 'تم التوصيل': return 'bg-green-100 text-green-800';
                case 'قيد التجهيز': case 'جاهز للاستلام': return 'bg-yellow-100 text-yellow-800';
                case 'ملغي': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // --- Functions for Dashboard (Admin Panel) ---
        function populateDashboard() { 
            const completedOrders = dummyRecentOrders.filter(o => o.status === 'مكتمل');
            const totalSales = completedOrders.reduce((sum, order) => sum + order.total, 0);
            const totalOrders = dummyRecentOrders.length;
            const avgOrderValue = totalOrders > 0 && completedOrders.length > 0 ? (totalSales / completedOrders.length) : 0;
            const topItem = itemsData.length > 0 ? itemsData[0] : {name: 'لا يوجد'}; 

            if(dashboardTotalSalesEl) dashboardTotalSalesEl.textContent = `${totalSales.toFixed(2)} جنيه`;
            if(dashboardTotalOrdersEl) dashboardTotalOrdersEl.textContent = totalOrders;
            if(dashboardCashOrdersEl) dashboardCashOrdersEl.textContent = `9 طلبات (بقيمة ١٬٢٥٠ جنيه)`;
            if(dashboardCardOrdersEl) dashboardCardOrdersEl.textContent = `15 طلبًا (بقيمة ٣٬٥٠٠ جنيه)`;
            if(dashboardTopItemEl) dashboardTopItemEl.textContent = topItem.name;
            if(dashboardTopItemSalesEl) dashboardTopItemSalesEl.textContent = `35 مرة`; 
            if(dashboardAvgOrderValueEl) dashboardAvgOrderValueEl.textContent = `${avgOrderValue.toFixed(2)} جنيه`;
            if(dashboardSalesComparisonEl) dashboardSalesComparisonEl.innerHTML = `+5% <i class="fas fa-arrow-up text-xs mr-1 text-green-600"></i>`;
            if(dashboardOrdersComparisonEl) dashboardOrdersComparisonEl.innerHTML = `-2% <i class="fas fa-arrow-down text-xs mr-1 text-red-600"></i>`;
            if(dashboardAvgPrepTimeEl) dashboardAvgPrepTimeEl.textContent = `12 دقيقة`;
            if(dashboardTotalExpenses) dashboardTotalExpenses.textContent = `350.00 جنيه`; // From static HTML
            if(dashboardNetProfit) dashboardNetProfit.textContent = `12,150 جنيه`; // From static HTML
            renderRecentOrders(dummyRecentOrders); 
        }
        function renderRecentOrders(ordersToRender) { 
            if (!recentOrdersTableBodyEl) return; 
            recentOrdersTableBodyEl.innerHTML = ''; 
            if (ordersToRender.length === 0) {
                recentOrdersTableBodyEl.innerHTML = `<tr><td colspan="6" class="text-center py-4 text-gray-500">لا توجد طلبات لعرضها.</td></tr>`;
                return;
            }
            const displayOrders = ordersToRender.slice(0,5); // Ensure only 5 are shown on dashboard
            displayOrders.forEach(order => {
                const row = document.createElement('tr');
                row.className = 'clickable-row';
                row.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">${order.id}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${formatOrderDateTime(order.dateTime).split(' ')[1]}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${order.type}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${order.total.toFixed(2)}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusClass(order.status)}">
                            ${order.status}
                        </span>
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${order.cashier}</td>`;
                row.addEventListener('click', () => showOrderDetails(order.id, dummyRecentOrders));
                recentOrdersTableBodyEl.appendChild(row);
            });
            if(paginationControls) paginationControls.innerHTML = `عرض ${displayOrders.length} من ${ordersToRender.length} طلب`;
        }
        
        // --- Functions for Order Details Modal (Admin Panel) ---
        function showOrderDetails(orderId, orderDataset = dummyDetailedOrders) { 
            const order = orderDataset.find(o => o.id === orderId); 
            if (!order || !orderDetailsModalTitle || !orderDetailsModalBody || !orderDetailsModal) return;
            orderDetailsModalTitle.textContent = `تفاصيل الطلب رقم: ${order.id}`;
            let itemsHtmlList = order.items.map(item => `<li>${item.name} (×${item.quantity}) - ${(item.price * item.quantity).toFixed(2)} جنيه ${item.notes ? `<em class="text-xs text-gray-500 block">- ${item.notes}</em>` : ''}</li>`).join('');
            const subtotal = order.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tax = order.total - subtotal;
            orderDetailsModalBody.innerHTML = `
                <p class="mb-1"><strong class="font-medium text-gray-600">التاريخ والوقت:</strong> ${formatOrderDateTime(order.dateTime)}</p>
                ${order.customerName ? `<p class="mb-1"><strong class="font-medium text-gray-600">العميل:</strong> ${order.customerName}</p>` : ''}
                <p class="mb-1"><strong class="font-medium text-gray-600">النوع:</strong> ${order.type}</p>
                <p class="mb-1"><strong class="font-medium text-gray-600">طريقة الدفع:</strong> ${order.paymentMethod}</p>
                <p class="mb-3"><strong class="font-medium text-gray-600">الحالة:</strong> <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusClass(order.status)}">${order.status}</span></p>
                <h4 class="font-semibold text-gray-700 mt-4 mb-2 border-b pb-1">الأصناف:</h4> <ul class="list-disc pr-5 space-y-1 text-sm">${itemsHtmlList}</ul>
                ${order.comment ? `<h4 class="font-semibold text-gray-700 mt-4 mb-1 border-b pb-1">تعليق عام:</h4><p class="text-sm italic text-gray-600">${order.comment}</p>` : ''}
                <div class="mt-4 pt-3 border-t">
                    <p class="flex justify-between text-sm"><span class="text-gray-600">الإجمالي الفرعي:</span> <span class="font-medium">${subtotal.toFixed(2)} جنيه</span></p>
                    <p class="flex justify-between text-sm"><span class="text-gray-600">الضريبة (تقريبي):</span> <span class="font-medium">${tax.toFixed(2)} جنيه</span></p>
                    <p class="flex justify-between text-lg font-bold mt-1"><span class="text-gray-800">الإجمالي النهائي:</span> <span class="text-orange-600">${order.total.toFixed(2)} جنيه</span></p>
                </div>`;
            openGenericModal(orderDetailsModal);
        }
        function openGenericModal(modalElement) { 
             if (!modalElement) return;
            modalElement.classList.remove('hidden');
            setTimeout(() => {
                modalElement.classList.remove('opacity-0');
                const modalContent = modalElement.querySelector('.modal-content');
                if (modalContent) modalContent.classList.remove('scale-95');
            }, 10);
        }
        function closeGenericModal(modalElement) { 
            if (!modalElement) return;
            const modalContent = modalElement.querySelector('.modal-content');
            if (modalContent) modalContent.classList.add('scale-95');
            modalElement.classList.add('opacity-0');
            setTimeout(() => modalElement.classList.add('hidden'), 300);
        }
        if(closeOrderDetailsModalBtn) closeOrderDetailsModalBtn.addEventListener('click', () => closeGenericModal(orderDetailsModal));
        if(cancelOrderDetailsModalBtn) cancelOrderDetailsModalBtn.addEventListener('click', () => closeGenericModal(orderDetailsModal));
        if(printOrderDetailsBtn) printOrderDetailsBtn.addEventListener('click', () => console.log('طباعة إيصال (محاكاة).'));

        // Event listeners for Dashboard Filters (Admin Panel)
        if(applyGlobalFiltersBtn) applyGlobalFiltersBtn.addEventListener('click', () => { console.log("تطبيق فلاتر الداشبورد (محاكاة)"); populateDashboard(); });
        if(applyFiltersBtn) applyFiltersBtn.addEventListener('click', () => { console.log("تطبيق فلاتر الطلبات الأخيرة (محاكاة)"); renderRecentOrders(dummyRecentOrders); });

        // --- Item Management Functions (Admin Panel) ---
        function populateModalCategorySelect() { 
            if (!itemCategorySelect) return; 
            itemCategorySelect.innerHTML = '<option value="" disabled selected>-- اختر فئة --</option>';
            initialCategories.forEach(cat => itemCategorySelect.add(new Option(cat.name, cat.id)));
        }
        function populateFilterItemCategorySelect() { 
            if (!filterItemCategorySelect) return;
            filterItemCategorySelect.innerHTML = '<option value="">كل الفئات</option>'; // Reset before populating
            initialCategories.forEach(cat => filterItemCategorySelect.add(new Option(cat.name, cat.id)));
        }
        function renderItemsTable(filteredItems = itemsData) { 
            if (!itemsTableBody) return;
            itemsTableBody.innerHTML = '';
            if (filteredItems.length === 0) {
                itemsTableBody.innerHTML = `<tr><td colspan="5" class="text-center py-10 text-gray-500"><i class="fas fa-box-open fa-3x mb-3"></i><br>لا توجد أصناف.</td></tr>`; return;
            }
            filteredItems.forEach(item => {
                const catName = initialCategories.find(c=>c.id === item.category)?.name || 'غير معروف';
                const row = itemsTableBody.insertRow();
                row.className = 'hover:bg-orange-50';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap"><div class="flex items-center"><div class="flex-shrink-0 h-12 w-12"><img class="h-12 w-12 rounded-md object-cover shadow-sm" src="${item.image_url || 'https://placehold.co/48x48/cccccc/999999?text=N/A'}" alt="${item.name}" onerror="this.onerror=null;this.src='https://placehold.co/48x48/cccccc/999999?text=Img';"></div><div class="mr-4"><div class="text-sm font-medium text-gray-900">${item.name}</div><div class="text-xs text-gray-500">${item.description ? item.description.substring(0,30)+(item.description.length > 30 ? '...' : '') : ''}</div></div></div></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${catName}</td> <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 font-semibold">${item.price.toFixed(2)} جنيه</td>
                    <td class="px-6 py-4 whitespace-nowrap text-center"><span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${item.is_available ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">${item.is_available ? 'متاح' : 'غير متاح'}</span></td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"><button data-id="${item.id}" class="edit-item-btn text-blue-600 hover:text-blue-800 mr-3 p-1 rounded-md hover:bg-blue-100" title="تعديل"><i class="fas fa-edit fa-fw"></i></button> <button data-id="${item.id}" class="delete-item-btn text-red-600 hover:text-red-800 p-1 rounded-md hover:bg-red-100" title="حذف"><i class="fas fa-trash fa-fw"></i></button></td>`;
            });
            itemsTableBody.querySelectorAll('.edit-item-btn').forEach(b => b.addEventListener('click', handleEditItem));
            itemsTableBody.querySelectorAll('.delete-item-btn').forEach(b => b.addEventListener('click', handleDeleteItem));
            if(itemsPaginationControls) itemsPaginationControls.innerHTML = `عرض ${filteredItems.length} من ${itemsData.length} صنف`;
        }
        function openItemModal(item = null) { 
            if (!itemForm || !modalTitle || !itemIdInput || !itemCategorySelect) return;
            itemForm.reset(); populateModalCategorySelect();
            if (item) {
                modalTitle.textContent = 'تعديل الصنف'; itemIdInput.value = item.id; itemNameInput.value = item.name;
                itemCategorySelect.value = item.category; itemPriceInput.value = item.price;
                itemDescriptionInput.value = item.description || ''; itemImageInput.value = item.image_url || '';
                itemIsAvailableInput.checked = item.is_available;
            } else {
                modalTitle.textContent = 'إضافة صنف جديد'; itemIdInput.value = ''; itemIsAvailableInput.checked = true;
            }
            openGenericModal(itemModal);
        }
        if(addItemBtnPage) addItemBtnPage.addEventListener('click', () => openItemModal());
        if(closeItemModalBtn) closeItemModalBtn.addEventListener('click', () => closeGenericModal(itemModal));
        if(cancelItemFormBtn) cancelItemFormBtn.addEventListener('click', () => closeGenericModal(itemModal));
        if(itemForm) itemForm.addEventListener('submit', (e) => { 
            e.preventDefault(); const id = itemIdInput.value;
            const data = { id: id ? parseInt(id) : Date.now(), name: itemNameInput.value.trim(), category: itemCategorySelect.value, price: parseFloat(itemPriceInput.value), description: itemDescriptionInput.value.trim(), image_url: itemImageInput.value.trim() || `https://placehold.co/100x70/F97316/FFF?text=${encodeURIComponent(itemNameInput.value.substring(0,10))}`, is_available: itemIsAvailableInput.checked };
            if (!data.name || !data.category || isNaN(data.price) || data.price < 0) { console.error("بيانات غير كاملة أو سعر غير صحيح"); return; }
            if (id) itemsData = itemsData.map(i => i.id === data.id ? data : i); else itemsData.push(data);
            renderItemsTable(); closeGenericModal(itemModal);
        });
        function handleEditItem(e) { 
            const item = itemsData.find(i => i.id === parseInt(e.currentTarget.dataset.id)); if(item) openItemModal(item);
        }
        function handleDeleteItem(e) { 
            if (confirm('هل أنت متأكد من الحذف؟')) { itemsData = itemsData.filter(i => i.id !== parseInt(e.currentTarget.dataset.id)); renderItemsTable(); }
        }
        if(applyItemFiltersBtn) applyItemFiltersBtn.addEventListener('click', () => { 
            const term = searchItemNameInput.value.toLowerCase().trim(); const cat = filterItemCategorySelect.value;
            renderItemsTable(itemsData.filter(i => (i.name.toLowerCase().includes(term)) && (cat ? i.category === cat : true)));
        });

        // --- Detailed Orders Page Functions (Admin Panel) ---
        function populateDetailedOrderStatusFilter() { /* Static HTML for now */ }
        function renderDetailedOrdersTable(filteredOrders = dummyDetailedOrders) { 
            if (!detailedOrdersTableBody) return; detailedOrdersTableBody.innerHTML = '';
            if (filteredOrders.length === 0) {
                detailedOrdersTableBody.innerHTML = `<tr><td colspan="8" class="text-center py-10 text-gray-500"><i class="fas fa-file-alt fa-3x mb-3 text-gray-400"></i><br>لا توجد طلبات.</td></tr>`; 
                if(detailedOrdersPaginationControls) detailedOrdersPaginationControls.innerHTML = '';
                return;
            }
            const pageOrders = filteredOrders.slice(0, 10); // Simple pagination
            pageOrders.forEach(order => {
                const row = detailedOrdersTableBody.insertRow(); row.className = 'hover:bg-yellow-50';
                row.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">${order.id}</td> <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${formatOrderDateTime(order.dateTime)}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${order.customerName || '-'}</td> <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${order.type}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 font-semibold">${order.total.toFixed(2)} جنيه</td> <td class="px-4 py-3 whitespace-nowrap text-center"><span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusClass(order.status)}">${order.status}</span></td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${order.cashier}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-center text-sm"><button data-id="${order.id}" class="view-order-details-btn text-indigo-600 hover:text-indigo-800 p-1 rounded-md hover:bg-indigo-100" title="عرض التفاصيل"><i class="fas fa-eye fa-fw"></i></button> <button data-id="${order.id}" class="change-order-status-btn text-green-600 hover:text-green-800 ml-2 p-1 rounded-md hover:bg-green-100" title="تغيير الحالة"><i class="fas fa-sync-alt fa-fw"></i></button> <button data-id="${order.id}" class="print-order-receipt-btn text-blue-600 hover:text-blue-800 ml-2 p-1 rounded-md hover:bg-blue-100" title="طباعة الإيصال"><i class="fas fa-print fa-fw"></i></button></td>`;
            });
            detailedOrdersTableBody.querySelectorAll('.view-order-details-btn').forEach(b => b.addEventListener('click', (e) => showOrderDetails(e.currentTarget.dataset.id, dummyDetailedOrders)));
            detailedOrdersTableBody.querySelectorAll('.change-order-status-btn').forEach(b => b.addEventListener('click', (e) => handleChangeOrderStatus(e.currentTarget.dataset.id)));
            detailedOrdersTableBody.querySelectorAll('.print-order-receipt-btn').forEach(b => b.addEventListener('click', (e) => handlePrintOrderReceipt(e.currentTarget.dataset.id)));
            if(detailedOrdersPaginationControls) detailedOrdersPaginationControls.innerHTML = `عرض ${pageOrders.length} من ${filteredOrders.length} طلب`;
        }
        function handleChangeOrderStatus(orderId) { 
            console.log(`تغيير حالة الطلب: ${orderId} (محاكاة)`);
            const order = dummyDetailedOrders.find(o => o.id === orderId);
            if (order) { 
                const statuses = ['قيد التجهيز', 'جاهز للاستلام', 'مكتمل', 'ملغي'];
                let nextStatusIndex = (statuses.indexOf(order.status) + 1) % statuses.length;
                order.status = statuses[nextStatusIndex]; 
                renderDetailedOrdersTable(); 
            }
        }
        function handlePrintOrderReceipt(orderId) { console.log(`طباعة إيصال: ${orderId} (محاكاة)`); }
        if (applyDetailedOrderFiltersBtn) applyDetailedOrderFiltersBtn.addEventListener('click', () => { 
            const id = searchDetailedOrderIdInput.value.toLowerCase().trim(); const status = filterDetailedOrderStatusSelect.value; const date = filterDetailedOrderDateInput.value;
            renderDetailedOrdersTable(dummyDetailedOrders.filter(o => (o.id.toLowerCase().includes(id)) && (status ? o.status === status : true) && (date ? o.dateTime.startsWith(date) : true)));
        });

        // --- Initial Load for the entire App Shell ---
        document.addEventListener('DOMContentLoaded', () => {
            // Default to login section visibility
        });

    </script>
</body>
</html>
